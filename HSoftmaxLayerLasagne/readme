This code comes from https://gist.github.com/justheuristic/581853c6d6b87eae9669297c2fb1052d#file-hierarchical_softmax_layer-py
Original license file attached.